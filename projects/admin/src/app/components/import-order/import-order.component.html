<div class="import-order-embedded">
  <div class="import-controls">
    <div class="form-group">
      <label for="fileInput">Select XLSX File:</label>
      <input type="file" id="fileInput" (change)="onFileChange($event)" accept=".xlsx" class="form-control">
    </div>
    <button class="btn btn-primary" (click)="parseXLSX()" [disabled]="isLoading || !fileToUpload">
      <i class="bi bi-file-earmark-arrow-up"></i> {{ isLoading ? 'Parsing...' : 'Parse and Preview' }}
    </button>
  </div>

  <div *ngIf="errorMessage" class="alert alert-danger mt-3">
    {{ errorMessage }}
  </div>

  <div *ngIf="successMessage" class="alert alert-success mt-3">
    {{ successMessage }}
  </div>

  <div *ngIf="isLoading && !errorMessage" class="loading-indicator mt-3">
    <p><i class="bi bi-hourglass-split"></i> Processing file, please wait...</p>
  </div>

  <div *ngIf="parsedData" class="parsed-data-container mt-4">
    <h3>Preview: {{ parsedData.fileName }}</h3>
    
    <!-- Collapsible Routes -->
    <div class="accordion">
      <div *ngFor="let route of parsedData.routes; let i = index" class="accordion-item">
        <!-- Route Header (always visible) -->
        <div class="accordion-header" (click)="toggleRoute(i)">
          <div class="route-summary">
            <i class="bi" [ngClass]="routeExpandState[i] ? 'bi-chevron-down' : 'bi-chevron-right'"></i>
            <span class="route-name">{{ route.routeName }}</span>
            <span class="route-count-badge">{{ route.stores.length }} store{{ route.stores.length !== 1 ? 's' : '' }}</span>
            <span class="route-total-badge">{{ calculateTotalItems(route) }} items</span>
            <span class="route-crates-badge">{{ calculateCrates(route) }} crate{{ calculateCrates(route) !== 1 ? 's' : '' }}</span>
          </div>
        </div>
        
        <!-- Route Content (collapsible) -->
        <div class="accordion-content" [class.expanded]="routeExpandState[i]">
          <ul *ngIf="route.stores.length > 0; else noStores" class="store-list">
            <li *ngFor="let store of route.stores" class="store-item">
              <div class="store-name">{{ store.customerName }}</div>
              <div class="store-items">Items: {{ store.totalItems }}</div>
            </li>
          </ul>
          <ng-template #noStores>
            <p>No orders with quantity > 0 for this route.</p>
          </ng-template>
        </div>
      </div>
    </div>
    
    <button class="btn btn-success mt-3" (click)="saveImportedData()" [disabled]="isLoading || isSaving">
      <i class="bi bi-database-add"></i> {{ isSaving ? 'Saving...' : 'Save Imported Data' }}
    </button>
  </div>
</div> 