<div class="admin-container">
  <!-- Header -->
  <header class="navbar">
    <div class="logo">OPTIROUTE</div>
    <div class="nav-links">
      <a class="nav-pill" routerLink="/dashboard">
        <i class="bi bi-speedometer2"></i> Dashboard
      </a>
      <a class="nav-pill" routerLink="/store-masterfile">
        <i class="bi bi-grid-3x3"></i> Store Masterfile
      </a>
    </div>
  </header>

  <div class="page-content">
    <div class="page-header">
      <h2><i class="bi bi-images"></i> Store Library</h2>
      <p>Manage store images with instructions and additional information</p>
    </div>

    <div class="alert alert-success" *ngIf="success">
      <i class="bi bi-check-circle-fill"></i> {{ success }}
      <button class="close-btn" (click)="clearMessages()"><i class="bi bi-x"></i></button>
    </div>

    <div class="alert alert-danger" *ngIf="error">
      <i class="bi bi-exclamation-triangle-fill"></i> {{ error }}
      <button class="close-btn" (click)="clearMessages()"><i class="bi bi-x"></i></button>
    </div>

    <div class="content-container">
      <!-- Search and list of stores -->
      <div class="stores-panel">
        <div class="search-box">
          <i class="bi bi-search search-icon"></i>
          <input 
            type="text" 
            placeholder="Search stores..."
            [(ngModel)]="searchTerm"
            (input)="searchStores()"
            class="search-input"
          >
        </div>

        <div class="stores-list">
          <div class="list-header">
            <h3>Select a Store</h3>
            <span class="store-count">{{ filteredStores.length }} stores</span>
          </div>
          
          <div class="store-items" *ngIf="!isLoading">
            <div 
              *ngFor="let store of filteredStores" 
              class="store-item"
              [class.active]="selectedStore && selectedStore.store_id === store.store_id"
              (click)="selectStore(store)"
            >
              <div class="store-code">{{ store.store_code || store.dispatch_code }}</div>
              <div class="store-name">{{ store.store_name || store.dispatch_store_name }}</div>
            </div>
            
            <div *ngIf="filteredStores.length === 0" class="no-results">
              No stores found matching "{{ searchTerm }}"
            </div>
          </div>
          
          <div class="loading-indicator" *ngIf="isLoading">
            <div class="spinner"></div>
            <span>Loading stores...</span>
          </div>
        </div>
      </div>

      <!-- Store management panel -->
      <div class="management-panel" *ngIf="selectedStore">
        <div class="panel-header">
          <h3>{{ selectedStore.store_name || selectedStore.dispatch_store_name }}</h3>
          <div class="store-details">
            <span class="detail-item"><strong>Store Code:</strong> {{ selectedStore.store_code }}</span>
            <span class="detail-item"><strong>Dispatch Code:</strong> {{ selectedStore.dispatch_code }}</span>
          </div>
        </div>

        <!-- Image upload section -->
        <div class="section-card">
          <div class="section-header">
            <h4><i class="bi bi-upload"></i> Upload Images</h4>
          </div>
          <div class="section-body">
            <div class="file-upload">
              <input 
                type="file" 
                id="store-images" 
                (change)="onFileSelected($event)"
                multiple
                accept="image/*"
                class="file-input"
              >
              <label for="store-images" class="file-label">
                <i class="bi bi-cloud-arrow-up"></i>
                <span>Choose Images</span>
                <span class="selected-files" *ngIf="selectedFiles.length">
                  {{ selectedFiles.length }} files selected
                </span>
              </label>
            </div>
            
            <button 
              class="upload-btn" 
              (click)="uploadImages()" 
              [disabled]="isUploading || !selectedFiles.length"
            >
              <i class="bi bi-cloud-upload"></i> Upload Images
            </button>
            
            <div class="upload-progress" *ngIf="isUploading">
              <div class="progress-bar" [style.width.%]="uploadProgress"></div>
            </div>
          </div>
        </div>

        <!-- Existing images and instructions -->
        <div class="section-card">
          <div class="section-header">
            <h4><i class="bi bi-images"></i> Store Images & Instructions</h4>
          </div>
          <div class="section-body">
            <div class="images-grid" *ngIf="selectedStore.images && selectedStore.images.length">
              <div class="image-card" *ngFor="let image of selectedStore.images">
                <div class="image-container">
                  <img [src]="image.url" alt="Store image" class="store-image">
                  <div class="image-actions">
                    <button class="action-btn delete-btn" (click)="deleteImage(image.id)" title="Delete image">
                      <i class="bi bi-trash"></i>
                    </button>
                  </div>
                </div>
                <div class="image-instructions">
                  <label for="instructions-{{image.id}}">Instructions:</label>
                  <textarea 
                    id="instructions-{{image.id}}"
                    [(ngModel)]="currentImageInstructions[image.id]"
                    placeholder="Add instructions for this image..."
                    rows="3"
                    class="instructions-input"
                  ></textarea>
                  <button 
                    class="save-btn" 
                    (click)="saveImageInstructions(image.id)"
                  >
                    <i class="bi bi-save"></i> Save Instructions
                  </button>
                </div>
              </div>
            </div>
            
            <div class="no-images" *ngIf="!selectedStore.images || !selectedStore.images.length">
              <i class="bi bi-image"></i>
              <p>No images have been uploaded for this store yet.</p>
            </div>
          </div>
        </div>

        <!-- Additional information section -->
        <div class="section-card">
          <div class="section-header">
            <h4><i class="bi bi-info-circle"></i> Additional Information</h4>
          </div>
          <div class="section-body">
            <div class="additional-info">
              <label for="additional-info">Enter any additional information for this store:</label>
              <textarea 
                id="additional-info"
                [(ngModel)]="additionalInfo"
                placeholder="Enter additional information, special instructions, or notes for this store..."
                rows="5"
                class="additional-info-input"
              ></textarea>
              <button 
                class="save-btn" 
                (click)="saveAdditionalInfo()"
              >
                <i class="bi bi-save"></i> Save Additional Info
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- No store selected message -->
      <div class="management-panel empty-state" *ngIf="!selectedStore && !isLoading">
        <div class="empty-state-content">
          <i class="bi bi-building"></i>
          <h3>No Store Selected</h3>
          <p>Please select a store from the list to manage its images and information.</p>
        </div>
      </div>
    </div>
  </div>
</div> 