<div class="route-planner-container">
  <header class="navbar">
    <div class="logo">OPTIROUTE</div>
    <div class="nav-links">
      <a class="nav-pill" routerLink="/dashboard">
        <i class="bi bi-arrow-left"></i> Back to Dashboard
      </a>
    </div>
  </header>

  <div class="content">
    <h2 class="page-title">Route Planner</h2>

    <!-- Route view mode toggle -->
    <div class="view-mode-selector">
      <div class="view-mode-label">View Mode:</div>
      <div class="view-mode-buttons">
        <button class="view-mode-btn" [class.active]="viewMode === 'selection'" (click)="setViewMode('selection')">
          Selection Mode
        </button>
        <button class="view-mode-btn" [class.active]="viewMode === 'filter'" (click)="setViewMode('filter')">
          Filter Mode
        </button>
      </div>
    </div>

    <!-- Route filter options (shown only in filter mode) -->
    <div class="route-filter" *ngIf="viewMode === 'filter'">
      <div class="filter-label">Filter Routes:</div>
      <div class="filter-buttons">
        <button class="filter-btn" [class.active]="routeType === 'all'" (click)="setRouteTypeFilter('all')">
          All Routes
        </button>
        <button class="filter-btn" [class.active]="routeType === 'old'" (click)="setRouteTypeFilter('old')">
          Old Routes
        </button>
        <button class="filter-btn" [class.active]="routeType === 'new'" (click)="setRouteTypeFilter('new')">
          New Routes
        </button>
      </div>
    </div>

    <!-- Saved routes list -->
    <div class="saved-routes" *ngIf="savedRoutes.length > 0">
      <h3>Routes <span *ngIf="viewMode === 'selection'">(Check boxes to select routes)</span></h3>
      <div class="routes-list">
        <div class="route-item" 
            *ngFor="let route of savedRoutes" 
            [class.hidden]="!shouldShowRoute(route)"
            [class.selected]="route.selected">
          
          <!-- Selection checkbox - always visible -->
          <div class="route-selection">
            <label class="checkbox-container">
              <input type="checkbox" 
                    [checked]="route.selected" 
                    (click)="toggleRouteSelection(route, $event)">
              <span class="checkmark"></span>
            </label>
          </div>

          <!-- Route content - clickable to load route -->
          <div class="route-content" (click)="loadRoute(route)">
            <div class="route-info">
              <div class="route-name">{{ route.name }}</div>
              <div class="route-type" [class.old-route]="route.type === 'old'" [class.new-route]="route.type === 'new'">
                {{ route.type === 'old' ? 'Old Route' : 'New Route' }}
              </div>
            </div>
            <div class="route-details">
              <div>From: {{ route.startLocation }}</div>
              <div>To: {{ route.endLocation }}</div>
              <div>Stops: {{ route.stops.length }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="route-form-container">
      <div class="form-controls">
        <!-- Start and End Locations -->
        <div class="locations-container">
          <div class="form-group">
            <label for="startLocation">Start Location</label>
            <input type="text" id="startLocation" [(ngModel)]="startLocation" class="form-control" placeholder="Enter start location">
          </div>
          
          <div class="form-group">
            <label for="endLocation">End Location</label>
            <input type="text" id="endLocation" [(ngModel)]="endLocation" class="form-control" placeholder="Enter end location">
          </div>
        </div>
        
        <!-- Stops -->
        <div class="stops-container">
          <h3>Stops</h3>
          <div class="stops-list">
            <div class="stop-row" *ngFor="let stop of stops; let i = index">
              <div class="form-group">
                <input type="text" [(ngModel)]="stops[i]" class="form-control" placeholder="Enter stop location">
              </div>
              <button class="remove-btn" (click)="removeStop(i)" *ngIf="stops.length > 1">
                <i class="bi bi-x-circle"></i>
              </button>
            </div>
          </div>
          <div class="buttons-row">
            <button class="add-stop-btn" (click)="addStop()">
              <i class="bi bi-plus-circle"></i> Add Stop
            </button>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="calculate-btn" (click)="calculateRoute()" [disabled]="isLoading || !apiLoaded">
            <i class="bi bi-calculator"></i> Calculate Route
          </button>
          <button class="clear-btn" (click)="clearRoute()" [disabled]="!apiLoaded">
            <i class="bi bi-trash"></i> Clear
          </button>
        </div>
        
        <!-- Loading indicator -->
        <div class="loading-indicator" *ngIf="isLoading">
          <i class="bi bi-hourglass-split"></i> Calculating route...
        </div>
      </div>

      <!-- Google Maps -->
      <div class="map-container">
        <!-- Maps API Loading State -->
        <div class="maps-loading" *ngIf="!apiLoaded">
          <div class="spinner">
            <i class="bi bi-arrow-repeat"></i>
          </div>
          <p>Loading Google Maps...</p>
        </div>
        
        <!-- Google Maps Component -->
        <google-map 
          *ngIf="apiLoaded"
          height="100%" 
          width="100%" 
          [center]="center" 
          [zoom]="zoom"
          [options]="options"
          (mapInitialized)="onMapInitialized($event)">
          
          <map-info-window></map-info-window>
          
          <map-marker 
            *ngFor="let marker of markers" 
            [position]="marker.position"
            [title]="marker.title"
            [options]="marker.options"
            (mapClick)="openInfoWindow(marker, marker.info)">
          </map-marker>
        </google-map>
      </div>
    </div>
  </div>
</div>
