<nav class="navbar">
  <div class="container-fluid">
    <div class="nav-left">
      <span class="nav-title">Store Library</span>
    </div>
    
    <a class="home-button-flat" routerLink="/dashboard">
      <i class="bi bi-house-fill"></i>
    </a>
  </div>
</nav>

<div class="search-box">
  <div class="search-input-container">
    <div class="input-with-icon">
      <i class="bi bi-search search-icon"></i>
      <input 
        type="text" 
        id="searchTerm" 
        [(ngModel)]="searchTerm" 
        class="form-control" 
        placeholder="Search by store code, dispatch code or name..." 
        (keyup.enter)="searchStore()"
        (input)="onSearchInput()"
      >
    </div>
    <button class="btn btn-primary search-btn" (click)="searchStore()">
      Search
    </button>
  </div>
  <small class="search-hint"></small>
  
  <div *ngIf="filteredOptions.length > 0 && searchTerm.length > 0" class="search-results">
    <div *ngFor="let result of filteredOptions" class="search-result-item" (click)="selectSearchResult(result)">
      <div class="result-item-code">{{ result.code }}</div>
      <div class="result-item-name">{{ result.name }}</div>
    </div>
  </div>
</div>

<!-- Store Code Header - Positioned directly under search box -->
<div *ngIf="storeDetails" class="store-code-header">
  <div class="code-value">{{ storeDetails.store_code }}</div>
</div>

<div *ngIf="loading" class="loading-container">
  <div class="spinner-border text-primary" role="status">
    <span class="sr-only">Loading...</span>
  </div>
  <p>Searching for store information...</p>
</div>

<div *ngIf="error" class="error-message">
  <i class="bi bi-exclamation-triangle-fill me-2"></i>
  {{ error }}
</div>

<div *ngIf="storeDetails" class="store-details-container">
  <!-- Storefront Image Display - This will be shown at the very top -->
  <div *ngIf="storefrontImage" class="storefront-image-container">
    <img [src]="storefrontImage.url" alt="Store Storefront" class="storefront-image">
    <div *ngIf="storefrontImage.instructions" class="storefront-instructions">
      <i class="bi bi-info-circle"></i> {{ storefrontImage.instructions }}
    </div>
  </div>

  <!-- Store Name Section - Only showing store name and dispatch code -->
  <div class="section-card">
    <div class="section-header">
      <h2><i class="bi bi-building"></i> Store Info</h2>
    </div>
    <div class="section-content">
      <table class="info-table">
        <tbody>
          <tr>
            <th>Store Name</th>
            <td>{{ storeDetails.store_name }}</td>
          </tr>
          <tr>
            <th>Dispatch Code</th>
            <td>{{ storeDetails.dispatch_code }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="section-card">
    <div class="section-header">
      <h2><i class="bi bi-geo-alt"></i> Location</h2>
    </div>
    <div class="section-content">
      <table class="info-table">
        <tbody>
          <tr>
            <th>Address</th>
            <td>{{ storeDetails.address_line || 'Not available' }}</td>
          </tr>
          <tr>
            <th>Eircode</th>
            <td>{{ storeDetails.eircode || 'Not available' }}</td>
          </tr>
          <tr>
            <th>Coordinates</th>
            <td>
              <span *ngIf="storeDetails.Latitude && storeDetails.Longitude">
                {{ storeDetails.Latitude }}, {{ storeDetails.Longitude }}
              </span>
              <span *ngIf="storeDetails.latitude && storeDetails.longitude">
                {{ storeDetails.latitude }}, {{ storeDetails.longitude }}
              </span>
              <span *ngIf="(!storeDetails.Latitude || !storeDetails.Longitude) && (!storeDetails.latitude || !storeDetails.longitude)">
                Not available
                <div class="mt-3">
                  <button class="btn btn-location compact" (click)="saveCurrentLocation()" [disabled]="savingLocation">
                    <i class="bi bi-geo-alt-fill me-2"></i>
                    <span *ngIf="!savingLocation">Save Current Location</span>
                    <span *ngIf="savingLocation">Saving...</span>
                  </button>
                </div>
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="section-card">
    <div class="section-header">
      <h2><i class="bi bi-shield-lock"></i> Access Information</h2>
    </div>
    <div class="section-content">
      <div class="access-code-container">
        <div class="access-code-item" *ngIf="storeDetails.door_code">
          <div class="code-icon">
            <i class="bi bi-door-open-fill"></i>
          </div>
          <div class="code-text">{{ storeDetails.door_code }}</div>
          <div class="code-label">Door</div>
        </div>
        
        <div class="access-code-item" *ngIf="storeDetails.alarm_code">
          <div class="code-icon">
            <i class="bi bi-shield-fill-check"></i>
          </div>
          <div class="code-text">{{ storeDetails.alarm_code }}</div>
          <div class="code-label">Alarm</div>
        </div>
        
        <div class="access-code-item" *ngIf="storeDetails.fridge_code">
          <div class="code-icon">
            <i class="bi bi-snow"></i>
          </div>
          <div class="code-text">{{ storeDetails.fridge_code }}</div>
          <div class="code-label">Fridge</div>
        </div>
        
        <div class="access-code-item" *ngIf="storeDetails.key_code">
          <div class="code-icon">
            <i class="bi bi-key-fill"></i>
          </div>
          <div class="code-text">{{ storeDetails.key_code }}</div>
          <div class="code-label">Key</div>
        </div>
        
        <div class="access-code-item" *ngIf="storeDetails.keys_available === 'Yes'">
          <div class="code-icon">
            <i class="bi bi-key-fill"></i>
          </div>
          <div class="code-text yes-label">Available</div>
          <div class="code-label">Keys</div>
        </div>
        
        <div class="access-code-empty" *ngIf="!storeDetails.door_code && !storeDetails.alarm_code && !storeDetails.fridge_code && !storeDetails.key_code && storeDetails.keys_available !== 'Yes'">
          <i class="bi bi-exclamation-circle"></i>
          <p>No access codes available</p>
        </div>
      </div>
    </div>
  </div>

  <div class="section-card">
    <div class="section-header">
      <h2><i class="bi bi-truck"></i> Delivery Information</h2>
    </div>
    <div class="section-content">
      <table class="info-table">
        <tbody>
          <tr>
            <th>24 Hour Access</th>
            <td>{{ storeDetails.hour_access_24 || 'No' }}</td>
          </tr>
          <tr>
            <th>Earliest Delivery</th>
            <td>{{ storeDetails.earliest_delivery_time || 'Not specified' }}</td>
          </tr>
          <tr>
            <th>Saturday Opening</th>
            <td>{{ storeDetails.opening_time_saturday || 'Not specified' }}</td>
          </tr>
          <tr>
            <th>Bank Holiday Opening</th>
            <td>{{ storeDetails.openining_time_bankholiday || 'Not specified' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Delivery Days Section -->
  <div class="section-card">
    <div class="section-header">
      <h2><i class="bi bi-calendar-check"></i> Delivery Days</h2>
    </div>
    <div class="section-content">
      <div class="delivery-days-grid">
        <div class="day-chip" [class.selected]="storeDetails.delivery_monday === 'Yes'">
          <i [class]="storeDetails.delivery_monday === 'Yes' ? 'bi bi-check-circle-fill' : 'bi bi-circle'"></i>
          Monday
        </div>
        <div class="day-chip" [class.selected]="storeDetails.delivery_tuesday === 'Yes'">
          <i [class]="storeDetails.delivery_tuesday === 'Yes' ? 'bi bi-check-circle-fill' : 'bi bi-circle'"></i>
          Tuesday
        </div>
        <div class="day-chip" [class.selected]="storeDetails.delivery_wednesday === 'Yes'">
          <i [class]="storeDetails.delivery_wednesday === 'Yes' ? 'bi bi-check-circle-fill' : 'bi bi-circle'"></i>
          Wednesday
        </div>
        <div class="day-chip" [class.selected]="storeDetails.delivery_thursday === 'Yes'">
          <i [class]="storeDetails.delivery_thursday === 'Yes' ? 'bi bi-check-circle-fill' : 'bi bi-circle'"></i>
          Thursday
        </div>
        <div class="day-chip" [class.selected]="storeDetails.delivery_friday === 'Yes'">
          <i [class]="storeDetails.delivery_friday === 'Yes' ? 'bi bi-check-circle-fill' : 'bi bi-circle'"></i>
          Friday
        </div>
        <div class="day-chip" [class.selected]="storeDetails.delivery_saturday === 'Yes'">
          <i [class]="storeDetails.delivery_saturday === 'Yes' ? 'bi bi-check-circle-fill' : 'bi bi-circle'"></i>
          Saturday
        </div>
      </div>
    </div>
  </div>

  <div class="section-card">
    <div class="section-header">
      <h2><i class="bi bi-images"></i> Store Images</h2>
    </div>
    <div class="section-content">
      <div *ngIf="imagesLoading" class="loading-spinner">
        <div class="spinner-border text-primary" role="status">
          <span class="sr-only">Loading...</span>
        </div>
        <p>Loading images...</p>
      </div>
      
      <div *ngIf="!imagesLoading && storeImages.length === 0" class="no-content">
        <i class="bi bi-image"></i>
        <p>No images available for this store</p>
      </div>
      
      <div *ngIf="!imagesLoading && storeImages.length > 0" class="image-gallery">
        <div class="image-grid">
          <div *ngFor="let image of getRegularImages()" class="image-item" (click)="selectImage(image)">
            <!-- Image container without overlay -->
            <img [src]="image.url" alt="Store image" class="gallery-image">
            <!-- Display instructions below the image if available -->
            <div *ngIf="image.instructions" class="image-instructions-preview">
              <i class="bi bi-info-circle"></i> {{ image.instructions }}
            </div>
          </div>
        </div>
        
        <!-- Selected image with annotations -->
        <div *ngIf="selectedImage" class="selected-image-container">
          <div class="image-preview">
            <img [src]="selectedImage.url" alt="Selected store image" class="full-image">
          </div>
          <div *ngIf="selectedImage.instructions" class="image-instructions">
            <h4>Notes:</h4>
            <p>{{ selectedImage.instructions }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Additional Info Section -->
  <div class="section-card" *ngIf="additionalInfo">
    <div class="section-header">
      <h2><i class="bi bi-info-circle-fill"></i> Additional Information</h2>
    </div>
    <div class="section-content">
      <div *ngIf="additionalInfoLoading" class="loading-spinner">
        <div class="spinner-border text-primary" role="status">
          <span class="sr-only">Loading...</span>
        </div>
        <p>Loading additional information...</p>
      </div>
      
      <div *ngIf="!additionalInfoLoading" class="additional-info">
        <p class="info-text">{{ additionalInfo }}</p>
      </div>
    </div>
  </div>
</div> 